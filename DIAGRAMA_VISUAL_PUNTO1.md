# DIAGRAMA VISUAL - FLUJO PUNTO 1

## ğŸ–¥ï¸ INTERFAZ DEL PANEL (Cada 2 segundos)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       --- PANEL DE MONITORIZACIÃ“N DE EV CHARGING ---        â”‚
â”‚==============================================================â”‚
â”‚ ID        â”‚ UBICACIÃ“N            â”‚ PRECIO    â”‚ ESTADO       â”‚
â”‚-----------â”œ--------------------- â”‚-----------â”‚--------------â”‚
â”‚ MAD-01    â”‚ C/ Serrano 10        â”‚ 0.25 â‚¬/kWhâ”‚ [GRIS]       â”‚
â”‚           â”‚                      â”‚           â”‚ DESCONECTADO â”‚
â”‚-----------â”œ--------------------- â”‚-----------â”‚--------------â”‚
â”‚ BCN-02    â”‚ Las Ramblas 55       â”‚ 0.25 â‚¬/kWhâ”‚ [GRIS]       â”‚
â”‚           â”‚                      â”‚           â”‚ DESCONECTADO â”‚
â”‚==============================================================â”‚
â”‚                                                                â”‚
â”‚ *** DRIVERS CONECTADOS ***                                    â”‚
â”‚ No hay drivers conectados.                                    â”‚
â”‚                                                                â”‚
â”‚ *** PETICIONES DE CONDUCTORES (Kafka) ***                     â”‚
â”‚ No hay peticiones pendientes.                                 â”‚
â”‚                                                                â”‚
â”‚ *** MENSAJES DEL SISTEMA ***                                  â”‚
â”‚ CENTRAL system status OK                                      â”‚
â”‚                                                                â”‚
â”‚==============================================================â”‚
â”‚ Comandos: [P]arar <CP_ID> â”‚ [R]eanudar <CP_ID> â”‚ [Q]uit      â”‚
â”‚ Ãšltima actualizaciÃ³n: 2025-XX-XX XX:XX:XX                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUJO COMPLETO DEL PUNTO 1

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    COMANDO DE EJECUCIÃ“N                       â•‘
â•‘                  py ev_central.py 8000 127.0.0.1:9092         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  1. VERIFICACIÃ“N ARGUMENTOS         â”‚
        â”‚  SOCKET_PORT = 8000                  â”‚
        â”‚  KAFKA_BROKER = 127.0.0.1:9092      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  2. INICIALIZACIÃ“N VARIABLES         â”‚
        â”‚  central_messages = []               â”‚
        â”‚  driver_requests = []                 â”‚
        â”‚  shared_producer = KafkaProducer()   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  3. INICIAR HILOS (DAEMON)          â”‚
        â”‚  â”œâ”€ kafka_thread                     â”‚
        â”‚  â”œâ”€ network_broadcast_thread        â”‚
        â”‚  â”œâ”€ server_thread                    â”‚
        â”‚  â”œâ”€ input_thread                     â”‚
        â”‚  â””â”€ cleanup_thread                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  4. DATABASE.SETUP_DATABASE()       â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conectar a    â”‚                    â”‚ Crear tablas  â”‚
â”‚ ev_charging.dbâ”‚                    â”‚ si no existen â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  5. DATABASE.GET_ALL_CPS()         â”‚
        â”‚  SELECT * FROM charging_points     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  6. MARCADO A DESCONECTADO          â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚               â”‚
        â–¼                       â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAD-01      â”‚    â”‚  BCN-02      â”‚  â”‚  ...         â”‚
â”‚  update_statusâ”‚   â”‚ update_status â”‚  â”‚ update_statusâ”‚
â”‚  'DESCONECTADO'â”‚ â”‚ 'DESCONECTADO'â”‚ â”‚ 'DESCONECTADO'â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  7. DISPLAY_PANEL() - CICLO INFINITOâ•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ clear_screen() â”‚                    â”‚ get_all_cps() â”‚
â”‚ Cada 2 segundosâ”‚                    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  8. MOSTRAR INFORMACIÃ“N             â”‚
        â”‚  - Tabla de CPs (GRIS=DESCONECTADO) â”‚
        â”‚  - Drivers conectados                â”‚
        â”‚  - Peticiones Kafka                  â”‚
        â”‚  - Mensajes del sistema              â”‚
        â”‚  - Comandos disponibles              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ESPERAR 2 SEGUNDOS                       â”‚
â”‚           Y REPETIR DESDE PASO 7                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ESTADO DE LA BASE DE DATOS

### Tabla: `charging_points`

| id      | location            | status       | price | driver_id | kwh | importe |
|---------|---------------------|--------------|-------|-----------|-----|---------|
| MAD-01  | C/ Serrano 10       | DESCONECTADO | 0.25  | NULL      | 0.0 | 0.0     |
| BCN-02  | Las Ramblas 55      | DESCONECTADO | 0.25  | NULL      | 0.0 | 0.0     |

### Tabla: `drivers`
```
(vacÃ­a al inicio)
```

### Tabla: `transactions`
```
(vacÃ­a al inicio)
```

---

## ğŸ¨ CÃ“DIGOS DE COLOR (ANSI Escape Codes)

```python
VERDE    = \033[92m    # ACTIVADO
GRIS     = \033[90m    # DESCONECTADO â† PUNTO 1
AZUL     = \033[94m    # SUMINISTRANDO
ROJO     = \033[91m    # AVERIADO
NARANJA  = \033[93m    # FUERA_DE_SERVICIO
CYAN     = \033[96m    # RESERVADO
```

---

## ğŸ” FUNCIONES INVOLUCRADAS (En orden de ejecuciÃ³n)

### `EV_Central.py`
1. âœ… **`__main__`** (lÃ­nea 841) - Punto de entrada
2. âœ… **`setup_database()`** (lÃ­nea 874) - Inicializa BD
3. âœ… **`get_all_cps()`** (lÃ­nea 879) - Obtiene CPs
4. âœ… **`update_cp_status()`** (lÃ­nea 883) - Marca DESCONECTADO
5. âœ… **`display_panel()`** (lÃ­nea 907) - Muestra panel

### `database.py`
1. âœ… **`setup_database()`** (lÃ­nea 56) - Crea tablas
2. âœ… **`get_all_cps()`** (lÃ­nea 167) - Consulta SQL
3. âœ… **`update_cp_status()`** (lÃ­nea 133) - Actualiza estado

---

## âœ¨ RESUMEN DEL PUNTO 1

**Â¿QuÃ© hace el Punto 1?**
> Central, al iniciar, marca TODOS los CPs como DESCONECTADO (gris) hasta que ellos se conecten y envÃ­en su estado real.

**Â¿Por quÃ© es importante?**
> Evita que Central asuma que un CP estÃ¡ activo cuando en realidad puede estar desconectado. Es un principio de "trust but verify".

**Â¿CuÃ¡ndo cambia el estado de DESCONECTADO?**
> Cuando el CP envÃ­a: `REGISTER#MAD-01#C/ Serrano 10#0.25`

---

## ğŸš€ PRÃ“XIMO PASO (Punto 2)

Cuando ejecutes:
```
py ev_cp_m.py 127.0.0.1 8000 127.0.0.1 8001 MAD-01
```

Esto activarÃ¡ el **PUNTO 2** donde el CP se conecta a Central.
